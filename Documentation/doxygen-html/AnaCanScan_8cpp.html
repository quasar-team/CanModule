<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CanModule: CanInterfaceImplementations/anagate/AnaCanScan.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CanModule
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">CanModule SW abstraction layer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('AnaCanScan_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">AnaCanScan.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="AnaCanScan_8h_source.html">AnaCanScan.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for AnaCanScan.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="AnaCanScan_8cpp__incl.png" border="0" usemap="#CanInterfaceImplementations_2anagate_2AnaCanScan_8cpp" alt=""/></div>
<!-- MAP 0 -->
</div>
</div>
<p><a href="AnaCanScan_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a07e042970e18b919d409eb09524d625c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#a07e042970e18b919d409eb09524d625c">DLLEXPORTFLAG</a></td></tr>
<tr class="separator:a07e042970e18b919d409eb09524d625c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9aa60e1ead64be77ad551e745cbfd4d3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#a9aa60e1ead64be77ad551e745cbfd4d3">WINAPI</a></td></tr>
<tr class="separator:a9aa60e1ead64be77ad551e745cbfd4d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac34d62b5ffd4e8e1c3ece118f3f58485"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#ac34d62b5ffd4e8e1c3ece118f3f58485">MLOGANA</a>(LEVEL,  THIS)&#160;&#160;&#160;LOG( Log::LEVEL, <a class="el" href="classAnaCanScan.html#a39ab4f1c865bef7349992abd4d91da1d">AnaCanScan::st_logItHandleAnagate</a>) &lt;&lt; __FUNCTION__ &lt;&lt; &quot; &quot; &lt;&lt; &quot; anagate bus= &quot; &lt;&lt; THIS-&gt;getBusName() &lt;&lt; &quot; &quot;</td></tr>
<tr class="separator:ac34d62b5ffd4e8e1c3ece118f3f58485"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae930092b65c48c86b99b5da2178b4692"><td class="memItemLeft" align="right" valign="top"><a class="el" href="MockCanAccess_8cpp.html#a07e042970e18b919d409eb09524d625c">DLLEXPORTFLAG</a> <a class="el" href="classCanModule_1_1CCanAccess.html">CCanAccess</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#ae930092b65c48c86b99b5da2178b4692">getCanBusAccess</a> ()</td></tr>
<tr class="separator:ae930092b65c48c86b99b5da2178b4692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5698349874e3653b879b5de27311594"><td class="memItemLeft" align="right" valign="top">void <a class="el" href="STCanScan_8cpp.html#a9aa60e1ead64be77ad551e745cbfd4d3">WINAPI</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#ad5698349874e3653b879b5de27311594">InternalCallback</a> (AnaUInt32 nIdentifier, const char *pcBuffer, AnaInt32 nBufferLen, AnaInt32 nFlags, AnaInt32 hHandle, AnaInt32 nSeconds, AnaInt32 nMicroseconds)</td></tr>
<tr class="separator:ad5698349874e3653b879b5de27311594"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a01df1cd6ffed5847fe25e00acdb71f46"><td class="memItemLeft" align="right" valign="top">std::recursive_mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#a01df1cd6ffed5847fe25e00acdb71f46">anagateReconnectMutex</a></td></tr>
<tr class="separator:a01df1cd6ffed5847fe25e00acdb71f46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a348494361939b368693ef24a71f3d9bc"><td class="memItemLeft" align="right" valign="top">std::map&lt; AnaInt32, <a class="el" href="classAnaCanScan.html">AnaCanScan</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AnaCanScan_8cpp.html#a348494361939b368693ef24a71f3d9bc">g_AnaCanScanObjectMap</a></td></tr>
<tr class="separator:a348494361939b368693ef24a71f3d9bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a07e042970e18b919d409eb09524d625c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07e042970e18b919d409eb09524d625c">&#9670;&nbsp;</a></span>DLLEXPORTFLAG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DLLEXPORTFLAG</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Â© Copyright CERN, 2015. All rights not expressly granted are reserved.</p>
<p><a class="el" href="AnaCanScan_8cpp.html">AnaCanScan.cpp</a></p>
<p>Created on: Mar 17, 2015 Author: pnikiel, vfilimon, quasar team Maintainer: mludwig at cern dot ch</p>
<p>This file is part of Quasar.</p>
<p>Quasar is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public Licence as published by the Free Software Foundation, either version 3 of the Licence.</p>
<p>Quasar is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public Licence for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public License along with Quasar. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<p>Here the Anagate ethernet-CAN bridges are implemented </p>

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00032">32</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

</div>
</div>
<a id="ac34d62b5ffd4e8e1c3ece118f3f58485"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac34d62b5ffd4e8e1c3ece118f3f58485">&#9670;&nbsp;</a></span>MLOGANA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MLOGANA</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">LEVEL, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">THIS&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;LOG( Log::LEVEL, <a class="el" href="classAnaCanScan.html#a39ab4f1c865bef7349992abd4d91da1d">AnaCanScan::st_logItHandleAnagate</a>) &lt;&lt; __FUNCTION__ &lt;&lt; &quot; &quot; &lt;&lt; &quot; anagate bus= &quot; &lt;&lt; THIS-&gt;getBusName() &lt;&lt; &quot; &quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00053">53</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

</div>
</div>
<a id="a9aa60e1ead64be77ad551e745cbfd4d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9aa60e1ead64be77ad551e745cbfd4d3">&#9670;&nbsp;</a></span>WINAPI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WINAPI</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00033">33</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae930092b65c48c86b99b5da2178b4692"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae930092b65c48c86b99b5da2178b4692">&#9670;&nbsp;</a></span>getCanBusAccess()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="MockCanAccess_8cpp.html#a07e042970e18b919d409eb09524d625c">DLLEXPORTFLAG</a> <a class="el" href="classCanModule_1_1CCanAccess.html">CCanAccess</a>* getCanBusAccess </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>creates and returns anagate can access object </p>

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00151">151</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

</div>
</div>
<a id="ad5698349874e3653b879b5de27311594"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5698349874e3653b879b5de27311594">&#9670;&nbsp;</a></span>InternalCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="STCanScan_8cpp.html#a9aa60e1ead64be77ad551e745cbfd4d3">WINAPI</a> InternalCallback </td>
          <td>(</td>
          <td class="paramtype">AnaUInt32&#160;</td>
          <td class="paramname"><em>nIdentifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pcBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnaInt32&#160;</td>
          <td class="paramname"><em>nBufferLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnaInt32&#160;</td>
          <td class="paramname"><em>nFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnaInt32&#160;</td>
          <td class="paramname"><em>hHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnaInt32&#160;</td>
          <td class="paramname"><em>nSeconds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnaInt32&#160;</td>
          <td class="paramname"><em>nMicroseconds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>call back to catch incoming CAN messages for reading. It is called on a handle, which is internally registered and managed by the anagate API. If that handle changes, the callback has to be unregistered before I guess. </p>

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00162">162</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

<p class="reference">References <a class="el" href="CanMessage_8h_source.html#l00029">CanMsgStruct::c_data</a>, <a class="el" href="CanMessage_8h_source.html#l00027">CanMsgStruct::c_dlc</a>, <a class="el" href="CanMessage_8h_source.html#l00025">CanMsgStruct::c_ff</a>, <a class="el" href="CanMessage_8h_source.html#l00023">CanMsgStruct::c_id</a>, <a class="el" href="CanMessage_8h_source.html#l00031">CanMsgStruct::c_time</a>, <a class="el" href="CanModuleUtils_8cpp_source.html#l00082">CanModule::canMessageToString()</a>, <a class="el" href="CanModuleUtils_8cpp_source.html#l00049">CanModule::convertTimepointToTimeval()</a>, <a class="el" href="CanModuleUtils_8cpp_source.html#l00079">CanModule::currentTimeTimeval()</a>, and <a class="el" href="AnaCanScan_8cpp_source.html#l00051">g_AnaCanScanObjectMap</a>.</p>

<p class="reference">Referenced by <a class="el" href="AnaCanScan_8cpp_source.html#l00786">AnaCanScan::connectReceptionHandler()</a>, and <a class="el" href="AnaCanScan_8cpp_source.html#l00424">AnaCanScan::openCanPort()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="AnaCanScan_8cpp_ad5698349874e3653b879b5de27311594_cgraph.png" border="0" usemap="#AnaCanScan_8cpp_ad5698349874e3653b879b5de27311594_cgraph" alt=""/></div>
<!-- MAP 1 -->
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a01df1cd6ffed5847fe25e00acdb71f46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01df1cd6ffed5847fe25e00acdb71f46">&#9670;&nbsp;</a></span>anagateReconnectMutex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::recursive_mutex anagateReconnectMutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00037">37</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="AnaCanScan_8cpp_source.html#l00673">AnaCanScan::reconnectAllPorts()</a>.</p>

</div>
</div>
<a id="a348494361939b368693ef24a71f3d9bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a348494361939b368693ef24a71f3d9bc">&#9670;&nbsp;</a></span>g_AnaCanScanObjectMap</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;AnaInt32, <a class="el" href="classAnaCanScan.html">AnaCanScan</a>*&gt; g_AnaCanScanObjectMap</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>global map of connection-objects: the map-key is the handle. Since handles are allocated by the OS the keys are getting changed as well when we reconnect, so that we do not keep the stale keys(=handles) in the map at all. The map is used in the (static) InternalCallback code straightforward and speedy, because we can get to the object by just looking up the map using the key(=the handle). The map manipulations are protected by serialization of reconnects with the anagateReconnectMutex. At RO access in the callbacks the map is NOT protected because we do not want to serialize the callbacks and because it is a RO map access, which is "like atomic". Well - it does work in multithreads.. ;-) </p>

<p class="definition">Definition at line <a class="el" href="AnaCanScan_8cpp_source.html#l00051">51</a> of file <a class="el" href="AnaCanScan_8cpp_source.html">AnaCanScan.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="AnaCanScan_8cpp_source.html#l00786">AnaCanScan::connectReceptionHandler()</a>, <a class="el" href="AnaCanScan_8cpp_source.html#l00837">AnaCanScan::eraseReceptionHandlerFromMap()</a>, <a class="el" href="AnaCanScan_8cpp_source.html#l00162">InternalCallback()</a>, <a class="el" href="AnaCanScan_8cpp_source.html#l00424">AnaCanScan::openCanPort()</a>, <a class="el" href="AnaCanScan_8cpp_source.html#l00673">AnaCanScan::reconnectAllPorts()</a>, <a class="el" href="AnaCanScan_8cpp_source.html#l00621">AnaCanScan::reconnectThisPort()</a>, and <a class="el" href="AnaCanScan_8cpp_source.html#l00603">AnaCanScan::showAnaCanScanObjectMap()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d8737b42f3d78efd22b75182e570f151.html">CanInterfaceImplementations</a></li><li class="navelem"><a class="el" href="dir_0dffaf26f41c2932de490572fa27ee8a.html">anagate</a></li><li class="navelem"><a class="el" href="AnaCanScan_8cpp.html">AnaCanScan.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
