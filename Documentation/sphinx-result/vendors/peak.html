
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Peak &#8212; CanModule 1.1.4 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logging" href="../logging.html" />
    <link rel="prev" title="AnaGate" href="anagate.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../logging.html" title="Logging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="anagate.html" title="AnaGate"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CanModule 1.1.4 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="peak">
<h1><a class="reference internal" href="#peak">Peak</a><a class="headerlink" href="#peak" title="Permalink to this headline">¶</a></h1>
<p>All modules from vendor <a class="reference internal" href="#peak">Peak</a> are handled by class PKCanScan (windows) or CSockCanScan (linux) which
both manage the modules through their underlying vendor specific API according to the OS.
Both classes provide the standard generic CanModule API.
Here the underlying vendor specific classes and the specific parameters are documented.</p>
<p>The modules from the families PCAN USB and USB Pro are supported.</p>
<div class="section" id="the-connection">
<h2>The connection<a class="headerlink" href="#the-connection" title="Permalink to this headline">¶</a></h2>
<p>To connect to a specific port for I/O, and send CAN messages, the following methods are used.</p>
<div class="section" id="windows">
<h3>windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p>the connection to a specific port for I/O is created by calling</p>
<dl class="class">
<dt id="_CPPv49PKCanScan">
<span id="_CPPv39PKCanScan"></span><span id="_CPPv29PKCanScan"></span><span id="PKCanScan"></span><span class="target" id="classPKCanScan"></span><em class="property">class </em><code class="descname">PKCanScan</code> : <em class="property">public</em> CanModule::<a class="reference internal" href="../standardApi.html#_CPPv4N9CanModule10CCanAccessE" title="CanModule::CCanAccess">CCanAccess</a><a class="headerlink" href="#_CPPv49PKCanScan" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt id="_CPPv4N9PKCanScan9createBusEK6stringK6string">
<span id="_CPPv3N9PKCanScan9createBusEK6stringK6string"></span><span id="_CPPv2N9PKCanScan9createBusEK6stringK6string"></span><span id="PKCanScan::createBus__stringC.stringC"></span><span class="target" id="classPKCanScan_1ae91999b9316ca127eecbabd9f27c3137"></span>bool <code class="descname">createBus</code><span class="sig-paren">(</span><em class="property">const</em> string <em>name</em>, <em class="property">const</em> string <em>parameters</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N9PKCanScan9createBusEK6stringK6string" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Method that initialises a CAN bus channel for peak (using PEAK Basic) All following methods called on the same object will be using this initialized channel. Only USB interfaces for PEAK modules, and only NON FD modules are supported for now.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>was the initialisation process successful? </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: = 2 parameters separated by “:” like “n0:n1”<ul>
<li>n0 = “pk” for peak</li>
<li>n1 = CAN port number on the module, can be prefixed with “can”: 0..N</li>
<li>ex.: “pk:can1” speaks to port 1 (the second port) on peak module at the ip</li>
<li>ex.: “pk:1” works as well</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">parameters</span></code>: one parameter: “p0”, positive integer<ul>
<li>”Unspecified” (or empty): using defaults = “125000” // params missing</li>
<li>p0: bitrate: 50000, 100000, 125000, 250000, 500000, 1000000 bit/s i.e. “250000”</li>
</ul>
</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv4N9PKCanScan11sendMessageEshPhb">
<span id="_CPPv3N9PKCanScan11sendMessageEshPhb"></span><span id="_CPPv2N9PKCanScan11sendMessageEshPhb"></span><span id="PKCanScan::sendMessage__short.unsigned-c.unsigned-cP.b"></span><span class="target" id="classPKCanScan_1a48a2e9ba00dae1b1fe01f7b095430503"></span>bool <code class="descname">sendMessage</code><span class="sig-paren">(</span>short <em>cobID</em>, unsigned char <em>len</em>, unsigned char *<em>message</em>, bool <em>rtr</em> = false<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N9PKCanScan11sendMessageEshPhb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>method to send a CAN message to the peak module. we use the standard API “PCAN-Basic” for this for windows and we talk only over USB to fixed bitrate modules. The flexible bitrate (FD) modules can be implemented later as well: for this we need more parameters to pass and a switch between CAN_Write and CAN_WriteFD. </p>
</dd></dl>

</div>
</dd></dl>

<p>and communication takes place through peak’s open-source PCAN-Basic windows library. Only “plug-and-play”
modules with USB interface and fixed datarate are supported by CanModule for now. PEAK’s flexible datarate (FD)
modules can be added later on (they need some different API-calls and more complex parameters), and also
other interfaces like PCI are possible for windows.The implementation is based on the PCAN-Basic driver.</p>
</div>
<div class="section" id="linux">
<h3>linux<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<p>The open-source socketcan interface is used on top of peak’s open source netdev driver. Both Peak’s
fixed and flexible datarate are working, although the fixed modules are recommended for bus compatibility.
Only modules with USB interface are supported.
The peak driver source is freely available and it can be configured to build several
types of drivers, where we use peak’s netdev driver only. See <a class="reference external" href="https://readthedocs.web.cern.ch/display/CANDev/CAN+development?src=sidebar">PeakDriver</a> for details on this.
A PCAN-Basic driver is also available but the netdev driver is more performant and modern. The
PCAN-Basic driver is used nevertheless for windows, and it offers better compatibility for all module
families.</p>
<dl class="class">
<dt id="_CPPv412CSockCanScan">
<span id="_CPPv312CSockCanScan"></span><span id="_CPPv212CSockCanScan"></span><span id="CSockCanScan"></span><span class="target" id="classCSockCanScan"></span><em class="property">class </em><code class="descname">CSockCanScan</code> : <em class="property">public</em> CanModule::<a class="reference internal" href="../standardApi.html#_CPPv4N9CanModule10CCanAccessE" title="CanModule::CCanAccess">CCanAccess</a><a class="headerlink" href="#_CPPv412CSockCanScan" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Functions</p>
<dl class="function">
<dt id="_CPPv4N12CSockCanScan9createBusEK6string6string">
<span id="_CPPv3N12CSockCanScan9createBusEK6string6string"></span><span id="_CPPv2N12CSockCanScan9createBusEK6string6string"></span><span id="CSockCanScan::createBus__stringC.string"></span><span class="target" id="classCSockCanScan_1ac5c669f96d2d6cf7387f8a646bd65b3f"></span>bool <code class="descname">createBus</code><span class="sig-paren">(</span><em class="property">const</em> string <em>name</em>, string <em>parameters</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N12CSockCanScan9createBusEK6string6string" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Method that initializes a can bus channel. The following methods called upon the same object will be using this initialized channel.</p>
<p><ul class="simple">
<li>i.e. “250000”</li>
</ul>
<dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: = 2 parameters separated by “:”, like “n0:n1”<ul>
<li>n0 = “sock” for sockets, used by systec and peak</li>
<li>n1 = CAN port number on the module, can be prefixed with “can”</li>
<li>ex.: “sock:can1” speaks to port 1 on systec or peak module</li>
<li>ex.: “sock:1” works as well</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">parameters</span></code>: one parameter: “p0”, positive integer<ul>
<li>”Unspecified” (or empty): using defaults = “125000” // params missing</li>
<li>p0: bitrate: 50000, 100000, 125000, 250000, 500000, 1000000 bit/s, other values might be allowed by the module</li>
</ul>
</li>
</ul>
</dd>
</dl>
</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>Was the initialization process successful? </dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv4N12CSockCanScan11sendMessageEshPhb">
<span id="_CPPv3N12CSockCanScan11sendMessageEshPhb"></span><span id="_CPPv2N12CSockCanScan11sendMessageEshPhb"></span><span id="CSockCanScan::sendMessage__short.unsigned-c.unsigned-cP.b"></span><span class="target" id="classCSockCanScan_1a485ec8621a98cdacad8e27433e09d919"></span>bool <code class="descname">sendMessage</code><span class="sig-paren">(</span>short <em>cobID</em>, unsigned char <em>len</em>, unsigned char *<em>message</em>, bool <em>rtr</em> = false<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N12CSockCanScan11sendMessageEshPhb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Method that sends a message trough the can bus channel. If the method createBUS was not called before this, sendMessage will fail, as there is no can bus channel to send a message through.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>Was the initialisation process successful? </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">cobID</span></code>: Identifier that will be used for the message. </li>
<li><code class="docutils literal notranslate"><span class="pre">len</span></code>: Length of the message. If the message is bigger than 8 characters, it will be split into separate 8 characters messages. </li>
<li><code class="docutils literal notranslate"><span class="pre">message</span></code>: Message to be sent trough the can bus. </li>
<li><code class="docutils literal notranslate"><span class="pre">rtr</span></code>: is the message a remote transmission request? </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
</dd></dl>

<p>sockets are used normally, using linux’ built-in CAN protocols:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">mysock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">PF_CAN</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="n">SOCK_RAW</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">CAN_RAW</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="standard-canmodule-api-example">
<h2>standard CanModule API example<a class="headerlink" href="#standard-canmodule-api-example" title="Permalink to this headline">¶</a></h2>
<p>This is how the CanModule standard API is used for peak for windows.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">libloader</span> <span class="o">=</span> <span class="n">CanModule</span><span class="o">::</span><span class="n">CanLibLoader</span><span class="o">::</span><span class="n">createInstance</span><span class="p">(</span> <span class="s">&quot;pk&quot;</span> <span class="p">);</span> <span class="c1">// windows, use &quot;sock&quot; for linux</span>
<span class="n">cca</span> <span class="o">=</span> <span class="n">libloader</span><span class="o">-&gt;</span><span class="n">openCanBus</span><span class="p">(</span> <span class="s">&quot;pk:can0&quot;</span><span class="p">,</span> <span class="s">&quot;250000&quot;</span> <span class="p">);</span> <span class="c1">// termination on frontpanel</span>
<span class="n">CanMessage</span> <span class="n">cm</span><span class="p">;</span> <span class="c1">// empty</span>
<span class="n">cca</span><span class="o">-&gt;</span><span class="n">sendMessage</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">cm</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../downloading.html">Downloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objective.html">Objective</a></li>
<li class="toctree-l1"><a class="reference internal" href="../standardApi.html">Standard API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cwrapper.html">C-Wrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="systec.html">SysTec</a></li>
<li class="toctree-l1"><a class="reference internal" href="anagate.html">AnaGate</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Peak</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-connection">The connection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#windows">windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linux">linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#standard-canmodule-api-example">standard CanModule API example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connection.html">Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/vendors/peak.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../logging.html" title="Logging"
             >next</a> |</li>
        <li class="right" >
          <a href="anagate.html" title="AnaGate"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CanModule 1.1.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, CERN, BE-ICS (Michael Ludwig).
      Last updated on 21-Jun-2019 14:04:00.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>