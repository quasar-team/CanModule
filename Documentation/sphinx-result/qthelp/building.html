
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Building</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="next" title="Running" href="running.html" />
    <link rel="prev" title="Logging" href="logging.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>CanModule 1.1.9.7 documentation</span></a></h1>
        <h2 class="heading"><span>Building</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="logging.html">Logging</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="running.html">Running</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="building">
<h1>Building</h1>
<p>We use <a class="reference external" href="https://cmake.org/">cmake</a> 3.0 or higher for multi-OS building.
The dependencies are:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://xerces.apache.org/xerces-c/">xerces</a>-c</p>
</li>
<li><p class="first"><a class="reference external" href="https://www.boost.org/">boost</a> (1.64.0 or later preferred, but any version &gt;=1.59.0 should work)</p>
</li>
<li><p class="first"><a class="reference external" href="https://gitlab.cern.ch/mludwig/CAN_libsocketcan">socketcan</a> libs (CC7, ubuntu) (not to be confused with the CanModule sockcan.so lib!).
They can also be found in various places for open software.</p>
</li>
<li><p class="first">dependencies for CanModule: LogIt (sources to github pulled in by cmake)</p>
</li>
<li><p class="first">vendor libs (to be installed on your build/target machine)</p>
</li>
<li><dl class="first docutils">
<dt>if general vendor builds are off you will build ONLY mockup. Using the toolchain:</dt>
<dd><ul class="first last simple">
<li>SET( CANMODULE_BUILD_VENDORS “OFF”) or UNSET( CANMODULE_BUILD_VENDORS ) or &lt;nothing&gt;</li>
<li>default is therefore “OFF” if you do nothing</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">if you need the general vendor builds, and usually that is the case, then you need to
switch them on explicitly in the toolchain:</p>
<blockquote>
<div><ul class="simple">
<li>SET( CANMODULE_BUILD_VENDORS “ON”)</li>
</ul>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>you can switch off selected vendor builds which you do not need using the toolchain:</dt>
<dd><blockquote class="first">
<div><ul class="simple">
<li>SET(CANMODULE_BUILD_SYSTEC “OFF”)</li>
<li>SET(CANMODULE_BUILD_ANAGATE “OFF”)</li>
<li>SET(CANMODULE_BUILD_PEAK “OFF”)</li>
</ul>
</div></blockquote>
<ul class="last simple">
<li>by default, all selected vendors are built</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>These dependencies should conveniently be injected into cmake using a toolchain file:</strong></p>
<div class="highlight-basemake notranslate"><div class="highlight"><pre><span></span>CMakeLists.txt:
---------------
(...other stuff)
#
# Load build toolchain file and internal checks before we start building
#
if( DEFINED CMAKE_TOOLCHAIN_FILE )
        message( STATUS &quot;[${CMAKE_CURRENT_LIST_FILE}:${CMAKE_CURRENT_LIST_LINE}]: CMAKE_TOOLCHAIN_FILE is defined -- including [${CMAKE_TOOLCHAIN_FILE}]&quot;)
        include( ${CMAKE_TOOLCHAIN_FILE} )
endif()
(...other stuff)
</pre></div>
</div>
<p><strong>The toolchain file would look like this (i.e. windows):</strong></p>
<div class="highlight-basemake notranslate"><div class="highlight"><pre><span></span>toolchain.cmake:
----------------
# toolchain for CANX-tester for CI jenkins, w10e
# mludwig at cern dot ch
# cmake -DCMAKE_TOOLCHAIN_FILE=jenkins_CanModule_w10e.cmake .
#
# boost
#
# bin download from sl
SET ( BOOST_PATH_LIBS &quot;M:/3rdPartySoftware/boost_1_59_0-msvc-14/lib64&quot; )
SET ( BOOST_HEADERS &quot;M:/3rdPartySoftware/boost_1_59_0-msvc-14&quot; )
SET ( BOOST_LIBS -lboost_log -lboost_log_setup -lboost_filesystem -lboost_system -lboost_chrono -lboost_date_time -lboost_thread  )
message( STATUS &quot;[${CMAKE_CURRENT_LIST_FILE}:${CMAKE_CURRENT_LIST_LINE}] toolchain defines [BOOST_PATH_LIBS:${BOOST_PATH_LIBS}]&quot; )
message( STATUS &quot;[${CMAKE_CURRENT_LIST_FILE}:${CMAKE_CURRENT_LIST_LINE}] toolchain defines [BOOST_HEADERS:${BOOST_HEADERS}]&quot; )
message( STATUS &quot;[${CMAKE_CURRENT_LIST_FILE}:${CMAKE_CURRENT_LIST_LINE}] toolchain defines [BOOST_LIBS:${BOOST_LIBS}]&quot; )
#
# LogIt, used by CANX directly as well
#
SET ( LOGIT_HEADERS   &quot;$ENV{JENKINSWS}/CanModule/LogIt/include&quot; )
SET ( LOGIT_PATH_LIBS &quot;$ENV{JENKINSWS}/CanModule/LogIt/lib&quot; )
SET ( LOGIT_LIBS &quot;-lLogIt&quot; )
#
# xerces-c
#
SET ( XERCES_PATH_LIBS &quot;M:/3rdPartySoftware/xerces-c-3.2.0_64bit/src/Debug&quot; )
SET ( XERCES_HEADERS &quot;M:/3rdPartySoftware/xerces-c-3.2.0_64bit/src&quot; )
SET ( XERCES_LIBS &quot;xerces-c_3D.lib&quot; )
#
# CanModule build behaviour:
# CANMODULE_BUILD_VENDORS OFF or not specified: only build mockup, do not build any vendor libs (default phony)
# CANMODULE_BUILD_VENDORS ON, nothing else: build mockup and all vendor libs (default all on)
# CANMODULE_BUILD_VENDORS ON, CANMODULE_BUILD_SYSTEC OFF: build mockup and all vendor libs except systec (drop systec)
# CANMODULE_BUILD_VENDORS ON, CANMODULE_BUILD_ANAGATE OFF: build mockup and all vendor libs except anagate (drop anagate)
# CANMODULE_BUILD_VENDORS ON, CANMODULE_BUILD_PEAK OFF: build mockup and all vendor libs except peak (drop peak)
SET(CANMODULE_BUILD_VENDORS &quot;ON&quot; )
# disable a vendor
#SET(CANMODULE_BUILD_SYSTEC &quot;OFF&quot;)
#SET(CANMODULE_BUILD_ANAGATE &quot;OFF&quot;)
SET(CANMODULE_BUILD_PEAK &quot;OFF&quot;)
#
# systec
# version 6.02 for windows 10 7may2018
SET( SYSTEC_LIB_FILE &quot;M:/3rdPartySoftware/SYSTEC-electronic/USB-CANmodul Utility Disk/Examples/Lib/USBCAN64.lib&quot;)
SET( SYSTEC_HEADERS &quot;M:/3rdPartySoftware/SYSTEC-electronic/USB-CANmodul Utility Disk/Examples/Include&quot;)
SET( SYSTEC_LIB_PATH &quot;M:/3rdPartySoftware/SYSTEC-electronic/USB-CANmodul Utility Disk/Examples/lib&quot; )
#
# anagate
# version vc8 as it seems
SET( ANAGATE_LIB_FILE &quot;AnaGateCanDll64.lib&quot;)
SET( ANAGATE_HEADERS &quot;M:/3rdPartySoftware/AnaGateCAN/win64/vc8/include&quot; )
SET( ANAGATE_LIB_PATH &quot;M:/3rdPartySoftware/AnaGateCAN/win64/vc8/Release&quot; )
#
## peak
## version PCAN Basic 4.3.2
##SET( PEAK_LIB_FILE &quot;PCANBasic.lib&quot;)
##SET( PEAK_HEADERS &quot;M:/3rdPartySoftware/PCAN-Basic API/Include&quot; )
##SET( PEAK_LIB_PATH &quot;M:/3rdPartySoftware/PCAN-Basic API/x64/VC_LIB&quot; )
</pre></div>
</div>
<p><strong>The toolchain gets then injected by running cmake:</strong></p>
<div class="highlight-basemake notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_TOOLCHAIN_FILE=toolchain.cmake
</pre></div>
</div>
<div class="section" id="shared-default-and-static-linking-loading">
<h2>shared (default) and static linking/loading</h2>
<p>CanModule uses all shared libraries, and also loads shared libraries during runtime for each connection
object and vendor. Nevertheless some shared libraries with reduced dependencies are made available
where possible (they have suffix <a href="#id1"><span class="problematic" id="id2">*</span></a>-static.so) for linux.
If the vendor APIs come, in some cases, in the form of relocateable static libraries/archives (-fPIC), then they
can sometimes be integrated into the CanModule specific vendor shared lib.</p>
<p><strong>Linux (CC7, ubuntu):</strong>
if the environment variable CANMODULE_AS_STATIC_AS_POSSIBLE=1 is set during building the <a href="#id3"><span class="problematic" id="id4">*</span></a>-static
libs are produced with boost and other specific dependencies integrated as possible:</p>
<ul class="simple">
<li>ancan-static.so</li>
<li>sockcan-static.so</li>
<li>CanModule-static.so</li>
</ul>
<p>During execution, CanModule(-static.so or .so) looks for the standard shared libs.
If you want to use the “reduced dependencies” versions then the env var CANMODULE_AS_STATIC_AS_POSSIBLE=1
has to be set <strong>during runtime</strong> as well.</p>
<p><strong>Windows</strong></p>
<p>No reduced dependencies libs are available at this point.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="logging.html">Logging</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="running.html">Running</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, CERN, BE-ICS (Michael Ludwig).
      Last updated on 07-Aug-2020 08:37:25.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>