
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Peak</title>
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="next" title="Logging" href="../logging.html" />
    <link rel="prev" title="AnaGate" href="anagate.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>CanModule 1.1.9.7 documentation</span></a></h1>
        <h2 class="heading"><span>Peak</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="anagate.html">AnaGate</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../logging.html">Logging</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="peak">
<h1><a class="reference internal" href="#peak">Peak</a></h1>
<p>All modules from vendor <a class="reference internal" href="#peak">Peak</a> are handled by class PKCanScan (windows) or CSockCanScan (linux) which
both manage the modules through their underlying vendor specific API according to the OS.
Both classes provide the standard generic CanModule API.
Here the underlying vendor specific classes and the specific parameters are documented.</p>
<p>The modules from the families PCAN USB and USB Pro are supported. For linux, also the flexible
datarate (FD) types are supported. The FD types are not supported for windows presently, but they
could be added in principle if requested.</p>
<div class="section" id="the-connection">
<h2>The connection</h2>
<p>To connect to a specific port for I/O, and send CAN messages, the following methods are used.</p>
<div class="section" id="windows">
<h3>windows</h3>
<p>the connection to a specific port for I/O is created by calling</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">doxygenclass: Cannot find file: /home/mludwig/projects/CanModule/CanModule-master/Documentation/sphinx-source/doxygen-result/xml/index.xml</p>
</div>
<p>and communication takes place through peak’s open-source PCAN-Basic windows library. Only “plug-and-play”
modules with USB interface and fixed datarate (non-FD) are supported by CanModule for now. PEAK’s flexible datarate (FD)
modules can be added later on (they need some different API-calls and more complex parameters), and also
other interfaces like PCI are possible for windows.The implementation is based on the PCAN-Basic driver.</p>
</div>
<div class="section" id="linux">
<h3>linux</h3>
<p>The open-source socketcan interface is used on top of peak’s open source netdev driver. Both Peak’s
fixed and flexible datarate are working, although the fixed modules are recommended for bus compatibility.
Only modules with USB interface are supported.
The peak driver source is freely available and it can be configured to build several
types of drivers, where we use peak’s netdev driver only. See <a class="reference external" href="https://readthedocs.web.cern.ch/display/CANDev/CAN+development?src=sidebar">PeakDriver</a> for details on this.
A PCAN-Basic driver is also available but the netdev driver is more performant and modern. The
PCAN-Basic driver is used nevertheless for windows, and it offers better compatibility for all module
families.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">doxygenclass: Cannot find file: /home/mludwig/projects/CanModule/CanModule-master/Documentation/sphinx-source/doxygen-result/xml/index.xml</p>
</div>
<p>sockets are used normally, using linux’ built-in CAN protocols:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">mysock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">PF_CAN</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="n">SOCK_RAW</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">CAN_RAW</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="standard-canmodule-api-example">
<h2>standard CanModule API example</h2>
<p>This is how the CanModule standard API is used for peak for windows.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">libloader</span> <span class="o">=</span> <span class="n">CanModule</span><span class="o">::</span><span class="n">CanLibLoader</span><span class="o">::</span><span class="n">createInstance</span><span class="p">(</span> <span class="s">&quot;pk&quot;</span> <span class="p">);</span> <span class="c1">// windows, use &quot;sock&quot; for linux</span>
<span class="n">cca</span> <span class="o">=</span> <span class="n">libloader</span><span class="o">-&gt;</span><span class="n">openCanBus</span><span class="p">(</span> <span class="s">&quot;pk:can0&quot;</span><span class="p">,</span> <span class="s">&quot;250000&quot;</span> <span class="p">);</span> <span class="c1">// termination on frontpanel</span>
<span class="n">CanMessage</span> <span class="n">cm</span><span class="p">;</span> <span class="c1">// empty</span>
<span class="n">cca</span><span class="o">-&gt;</span><span class="n">sendMessage</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">cm</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="anagate.html">AnaGate</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../logging.html">Logging</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, CERN, BE-ICS (Michael Ludwig).
      Last updated on 07-Aug-2020 08:37:25.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>